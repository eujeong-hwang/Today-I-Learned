# ğŸ“ 2021-11-16

<í•œ ì¼>
- ì¢‹ì•„ìš” ë“±ë¡, ì·¨ì†Œ ê¸°ëŠ¥ êµ¬í˜„
- ì¢‹ì•„ìš” ì´ ê°œìˆ˜ ì¡°íšŒí•˜ê¸° ê¸°ëŠ¥ êµ¬í˜„
- ì¢‹ì•„ìš” ë†’ì€ ìˆœ ëŒ€ë¡œ ì •ë ¬í•˜ê¸° ê¸°ëŠ¥ êµ¬í˜„


## ğŸ–¥ ì¢‹ì•„ìš” ë†’ì€ ìˆœëŒ€ë¡œ ì •ë ¬í•˜ê¸° ê¸°ëŠ¥ êµ¬í˜„

1. ë‚˜ëŠ” ì¢‹ì•„ìš” ê¸°ëŠ¥ì„ ë§Œë“¤ ë–„, ì¢‹ì•„ìš” í…Œì´ë¸”ì„ ì´ë ‡ê²Œ ë§Œë“¤ì—ˆë‹¤. ì´ ì¢‹ì•„ìš” ê°œìˆ˜ëŠ” í¬í•¨ ì‹œí‚¤ì§€ ì•Šê³  ë§Œë“¤ì—ˆë‹¤.
```CREATE TABLE `likes` (
  `likeId` INT NOT NULL AUTO_INCREMENT,
  `createdAt` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `dogPostId` INT NOT NULL,
  `userId` INT NOT NULL,
  PRIMARY KEY (`likeId`),
  KEY `likeId` (`likeId`),
  KEY `dogPostId` (`dogPostId`),
  KEY `userId` (`userId`),
  FOREIGN KEY (`dogPostId`) REFERENCES `dogSta` (`dogPostId`) ON UPDATE CASCADE,
  FOREIGN KEY (`userId`) REFERENCES `user` (`userId`) ON UPDATE CASCADE
) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8mb4
```

2. ì¢‹ì•„ìš” ì´ ê°œìˆ˜ êµ¬í•˜ëŠ” ê²ƒì€ ë”°ë¡œ apië¥¼ ë§Œë“¤ì—ˆë‹¤. COUNTë¥¼ ì¨ì„œ, ê°œìŠ¤íƒ€ê·¸ë¨ì— ì¢‹ì•„ìš” í•œ ì´ ê°œìˆ˜ë¥¼ ê³„ì‚°ì„ í–ˆë‹¤. 

```router.get("/:dogPostId", async (req, res) => {
  try {
    const { dogPostId } = req.params;

    let likeCount;
    const likeUser = `SELECT dogPostId FROM likes WHERE dogPostId ="${dogPostId}"`;
    const results = await db.query(likeUser);
    likeCount = results[0];

    if (likeCount) {
      let likeNum;
      const likeQuery = `SELECT COUNT(dogPostId) as count FROM likes WHERE dogPostId ="${dogPostId}"`;
      const results = await db.query(likeQuery)
      likeNum = results[0];  

      await db.query(likeQuery, (error, rows) => {
        if (error) {
          console.log(error);
          return res.status(400).json({
            success: false,
          });
        }
        return res.status(200).send({
          likeNum
        });
      });
    } else {
      let likeNum;
      const likeQuery = `SELECT COUNT(dogPostId) as count FROM likes WHERE dogPostId ="${dogPostId}"`;
      const results = await db.query(likeQuery)
      likeNum = results[0];  

      await db.query(likeQuery, (error, rows) => {
        if (error) {
          return res.status(400).json({
            success: false,
          });
        }
        return res.status(200).send({
          likeNum
        });
      });
    }
  } catch (err) {
    return res.status(500).send({
      msg: "ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”",
    });
  }
});
```

3. ê°œìŠ¤íƒ€ê·¸ë¨ ë©”ì¸ ì¡°íšŒí•˜ê¸°ë¥¼ í•  ë•Œ, ì¢‹ì•„ìš” ë†’ì€ ìˆœìœ¼ë¡œ ì¡°íšŒë¥¼ ê°€ëŠ¥í•˜ê²Œ filterë¥¼ ë§Œë“¤ì–´ì•¼ í–ˆë‹¤. ì´ë•Œ, dogPostIdë¥¼ parameterë¡œ ë°›ì§€ë„ ëª»í•˜ê³ , ì¢‹ì•„ìš” ì´ ê°œìˆ˜ë„ tableë¡œ ì•ˆ ë§Œë“¤ì—ˆë‹¤ ë³´ë‹ˆê¹ COUNTë¥¼ ì´ìš©í•´ì„œ ë³´ì—¬ì¤˜ì•¼ í–ˆë‹¤. ì¿¼ë¦¬ë¬¸ì„ ì´ë ‡ê²Œ ì§œë‹ˆê¹ ì˜ í•´ê²° ë˜ì—ˆë‹¤!
 ``` const likeQuery = `SELECT *,
    (SELECT COUNT(likes.dogPostId) FROM likes WHERE likes.dogPostId = dogSta.dogPostId) as count
      FROM dogSta 
      JOIN user
      ON dogSta.userId = user.userId
      LEFT JOIN dog
      ON  dog.userId = user.userId
      ORDER BY count DESC`;
     ```       