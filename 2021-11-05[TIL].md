# ğŸ“ 2021-11-05
- ì˜¤ëŠ˜ì˜ TIL

## ğŸ–¥ AWS S3 bucket ì‚¬ìš©í•˜ê¸°, multer ëª¨ë“ˆ ì´ìš©í•˜ê¸°

- `AWSì—ì„œ S3 bucket ìƒì„±`

1. AWS ë¡œê·¸ì¸ í›„, S3 bucketì„ ìƒì„±í•©ë‹ˆë‹¤. 
<img width="934" alt="S31" src="https://user-images.githubusercontent.com/59908525/140505533-aa9d65d2-e1d5-48b8-8700-46c645a9d410.PNG">


2. ìƒì„± bucketì— ëŒ€í•´ì„œ public accessì¼ ìˆ˜ ìˆë„ë¡, permissionì„ ì—´ì–´ì¤˜ì•¼ í•œë‹¤.
<img width="700" alt="s3 public" src="https://user-images.githubusercontent.com/59908525/140505597-78fe9a00-7229-4947-b4f9-e883f802a8dd.PNG">


3. My Security Credentialsì— ê°€ì„œ, Access keysì— ê°€ì„œ access key IDì™€ secret access keyë¥¼ ë°œê¸‰ ë°›ëŠ”ë‹¤!
<img width="956" alt="credentials" src="https://user-images.githubusercontent.com/59908525/140503967-d3169260-5425-499e-9d06-76241c914e66.PNG">

4. access key IDì™€ secret access keyëŠ” ì‚¬ìš©í•´ì•¼ í•˜ë‹ˆ ì˜ ë³´ê´€í•˜ëŠ”ê²Œ ì¢‹ë‹¤!

<br>

- `í•„ìš”í•œ ëª¨ë“ˆ ì„¤ì¹˜`
    - multer
    - multer-s3
    - aws-sdk

- `.env íŒŒì¼`
    - .env íŒŒì¼ì— ì•„ê¹Œ ìƒì„±í•œ access key ID ì™€ secret access key, ê·¸ë¦¬ê³  regionì„ í™˜ê²½ë³€ìˆ˜ë¥¼ ì´ìš©í•´ ì €ì¥í•´ì¤€ë‹¤. 

- `s3.js íŒŒì¼`
    - S3ë¼ëŠ” folderì•ˆì—, s3.jsë¥¼ ë§Œë“¤ì–´ì„œ ë°‘ì— ì½”ë“œë¥¼ ì ì—ˆë‹¤.       
    ```const path = require('path');
       const multer = require('multer');
       const multerS3 = require('multer-s3');
       const AWS = require('aws-sdk');

       require('dotenv').config();

       const s3 = new AWS.S3({ 
         accessKeyId: process.env.S3_KEYID, 
         secretAccessKey: process.env.S3_PRIVATE_KEY,
         region: process.env.region
       });

       const upload = multer({
          storage: multerS3({
            s3: s3,
            bucket: "doggy-project-bucket",
            acl: 'public-read-write',
            key: function (req, file, cb) {
              const extension = path.extname(file.originalname);
              cb(null, Date.now().toString() + extension);
           },
          }),
        });
     module.exports = upload;
     ```       
